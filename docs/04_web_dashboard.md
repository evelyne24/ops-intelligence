# Web Dashboard

The `dashboard` service is a Streamlit application that provides a web interface to visualize the operational intelligence data generated by the `analyzer` service. The source code is in `src/web/dashboard.py`.

## Functionality

The dashboard fetches analysis results from an S3 bucket and presents them in an interactive format.

### Data Loading

-   The application connects to S3 (or a local LocalStack equivalent) to list all available analysis run files.
-   A sidebar allows the user to select a specific run from the history, sorted with the newest first.
-   If no data is found, it displays a warning prompting the user to run the `analyze` command.
-   It includes error handling for loading and parsing the JSON data from S3.

### Metrics Display

The dashboard presents KPIs and visualizations in a multi-column layout:

-   **KPIs**:
    -   **Ghost Work**: Percentage of pull requests without a linked Jira ticket.
    -   **High Churn Tickets**: Count of tickets with a high number of "churn" events.
    -   **Total Throughput**: Total number of tickets processed.
-   **Charts**:
    -   A bar chart visualizing the distribution of **Ticket Churn** events.
-   **Raw Data**:
    -   A table showing a sample of the raw ticket data.

## Running the Dashboard

The dashboard is started by running the `dashboard` command of the main application:

```bash
python main.py dashboard
```

When using Docker Compose, this is handled automatically. You can access the dashboard in your browser at [http://localhost:8501](http://localhost:8501).

## Code Overview

```python
import streamlit as st
import pandas as pd
import json
import plotly.express as px
from ops_intelligence.aws import S3Client

def main():
    st.set_page_config(layout="wide", page_title="Ops Intelligence")
    s3 = S3Client()

    # --- 1. Fetch History from S3 ---
    with st.spinner("Connecting to Cloud Storage..."):
        files = s3.list_files()

    # --- 2. Sidebar Selector ---
    st.sidebar.title("üóÇÔ∏è Run History")
    selected_key = st.sidebar.selectbox("Select Analysis Run:", 
                                        options=[f['Key'] for f in files])

    # --- 3. Download & Parse ---
    raw_content = s3.download_as_json(selected_key)
    data = json.loads(raw_content)

    # --- 4. Render Dashboard ---
    stats = data.get("summary", {})
    st.title(f"üìä Dashboard: {selected_key}")
    
    # KPI Row
    k1, k2, k3 = st.columns(3)
    k1.metric("Ghost Work", f"{stats.get('ghost_work_pct', 0)}%")
    k2.metric("High Churn Tickets", stats.get('high_churn_count', 0))
    k3.metric("Total Throughput", stats.get('total_tickets', 0))
    
    # Charts
    tickets = pd.DataFrame(data.get("raw_tickets", []))
    # ... (Chart rendering logic)

if __name__ == "__main__":
    main()
```
